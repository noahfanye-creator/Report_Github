# èµ„é‡‘é¢æ•°æ®åˆ†ææ¨¡å—è®¾è®¡ä¸é›†æˆæ–¹æ¡ˆ

## ä¸€ã€èµ„é‡‘é¢æ•°æ®æ¨¡å—æ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„
```
èµ„é‡‘é¢æ•°æ®æ¨¡å—
â”œâ”€â”€ æ•°æ®è·å–å±‚
â”‚   â”œâ”€â”€ èµ„é‡‘æµå‘æ•°æ®è·å–å™¨
â”‚   â”œâ”€â”€ èèµ„èåˆ¸æ•°æ®è·å–å™¨
â”‚   â”œâ”€â”€ å¤§å®—äº¤æ˜“æ•°æ®è·å–å™¨
â”‚   â””â”€â”€ æŒè‚¡æ•°æ®è·å–å™¨
â”œâ”€â”€ åˆ†æè®¡ç®—å±‚
â”‚   â”œâ”€â”€ èµ„é‡‘æµå‘åˆ†æå™¨
â”‚   â”œâ”€â”€ ä¸»åŠ›èµ„é‡‘è¯†åˆ«å™¨
â”‚   â”œâ”€â”€ èµ„é‡‘æƒ…ç»ªè®¡ç®—å™¨
â”‚   â””â”€â”€ èµ„é‡‘å…±æŒ¯åˆ†æå™¨
â”œâ”€â”€ å¯è§†åŒ–å±‚
â”‚   â”œâ”€â”€ èµ„é‡‘æµå‘å›¾è¡¨
â”‚   â”œâ”€â”€ èµ„é‡‘æƒ…ç»ªä»ªè¡¨æ¿
â”‚   â””â”€â”€ èµ„é‡‘å…±æŒ¯çƒ­åŠ›å›¾
â””â”€â”€ æŠ¥å‘Šé›†æˆå±‚
    â”œâ”€â”€ èµ„é‡‘é¢åˆ†æç« èŠ‚
    â”œâ”€â”€ èµ„é‡‘ä¿¡å·ç”Ÿæˆå™¨
    â””â”€â”€ AIæ•°æ®æ ¼å¼åŒ–
```

### 1.2 èµ„é‡‘é¢æ•°æ®åˆ†ç±»

| æ•°æ®ç±»å‹ | Aè‚¡ç‰¹æœ‰ | æ¸¯è‚¡ç‰¹æœ‰ | æ•°æ®é¢‘ç‡ | æ›´æ–°å»¶è¿Ÿ |
|---------|--------|---------|---------|---------|
| åŒ—å‘èµ„é‡‘ | âœ“ | - | æ¯æ—¥ | T+1ï¼ˆç›˜ä¸­å®æ—¶ï¼‰ |
| å—å‘èµ„é‡‘ | âœ“ | âœ“ | æ¯æ—¥ | T+1 |
| ä¸»åŠ›èµ„é‡‘ | âœ“ | âœ“ | å®æ—¶ | 15åˆ†é’Ÿ |
| èèµ„èåˆ¸ | âœ“ | - | æ¯æ—¥ | T+1 |
| å¤§å®—äº¤æ˜“ | âœ“ | âœ“ | æ¯æ—¥ | T+1 |
| æœºæ„æŒè‚¡ | âœ“ | âœ“ | å­£åº¦ | å­£åº¦æœ« |
| èµ„é‡‘æƒ…ç»ª | âœ“ | âœ“ | å®æ—¶ | å³æ—¶ |
| æ¿å—èµ„é‡‘ | âœ“ | âœ“ | å®æ—¶ | 15åˆ†é’Ÿ |

## äºŒã€æ–°å¢PythonåŒ…ä¾èµ–

```txt
# èµ„é‡‘é¢æ•°æ®ä¸“ç”¨åŒ…
akshare>=1.12.0  # æ–°å¢èµ„é‡‘é¢æ•°æ®æ¥å£
tushare>=1.2.89  # èèµ„èåˆ¸æ•°æ®
easyquotation>=0.7.0  # å®æ—¶èµ„é‡‘æµ
stockstats>=0.3.2  # èµ„é‡‘æµæŒ‡æ ‡è®¡ç®—

# æ•°æ®å¤„ç†å¢å¼º
scikit-learn>=1.3.0  # èµ„é‡‘æ¨¡å¼è¯†åˆ«
networkx>=3.1  # èµ„é‡‘æµå‘ç½‘ç»œåˆ†æ
plotly>=5.15.0  # äº¤äº’å¼èµ„é‡‘æµå‘å›¾

# æ•°æ®åº“æ”¯æŒï¼ˆå¯é€‰ï¼‰
sqlalchemy>=2.0.0
redis>=5.0.0  # å®æ—¶èµ„é‡‘æ•°æ®ç¼“å­˜
```

## ä¸‰ã€æ–°å¢æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ ğŸ“ capital_flow/                    # èµ„é‡‘é¢åˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ğŸ“ data_sources/               # èµ„é‡‘æ•°æ®æº
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ capital_flow_data.py       # èµ„é‡‘æµå‘æ•°æ®è·å–
â”‚   â”‚   â”œâ”€â”€ margin_trading_data.py     # èèµ„èåˆ¸æ•°æ®è·å–
â”‚   â”‚   â”œâ”€â”€ block_trading_data.py      # å¤§å®—äº¤æ˜“æ•°æ®è·å–
â”‚   â”‚   â”œâ”€â”€ holding_data.py            # æŒè‚¡æ•°æ®è·å–
â”‚   â”‚   â””â”€â”€ sentiment_data.py          # èµ„é‡‘æƒ…ç»ªæ•°æ®
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ analysis/                   # èµ„é‡‘åˆ†æå¼•æ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ capital_flow_analyzer.py   # èµ„é‡‘æµå‘åˆ†æ
â”‚   â”‚   â”œâ”€â”€ main_force_identifier.py   # ä¸»åŠ›èµ„é‡‘è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ sentiment_calculator.py    # èµ„é‡‘æƒ…ç»ªè®¡ç®—
â”‚   â”‚   â”œâ”€â”€ resonance_analyzer.py      # èµ„é‡‘å…±æŒ¯åˆ†æ
â”‚   â”‚   â””â”€â”€ sector_flow_analyzer.py    # æ¿å—èµ„é‡‘åˆ†æ
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ indicators/                 # èµ„é‡‘é¢æŒ‡æ ‡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ flow_indicators.py         # èµ„é‡‘æµæŒ‡æ ‡
â”‚   â”‚   â”œâ”€â”€ sentiment_indicators.py    # æƒ…ç»ªæŒ‡æ ‡
â”‚   â”‚   â”œâ”€â”€ strength_indicators.py     # èµ„é‡‘å¼ºåº¦æŒ‡æ ‡
â”‚   â”‚   â””â”€â”€ anomaly_indicators.py      # èµ„é‡‘å¼‚åŠ¨æŒ‡æ ‡
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ visualization/              # èµ„é‡‘å¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ flow_charts.py             # èµ„é‡‘æµå‘å›¾
â”‚   â”‚   â”œâ”€â”€ sentiment_dashboard.py     # æƒ…ç»ªä»ªè¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ heatmap_generator.py       # çƒ­åŠ›å›¾ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ network_visualizer.py      # èµ„é‡‘ç½‘ç»œå›¾
â”‚   â”‚   â””â”€â”€ sankey_diagram.py          # æ¡‘åŸºå›¾
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ integration/                # æŠ¥å‘Šé›†æˆ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ report_section.py          # æŠ¥å‘Šç« èŠ‚ç”Ÿæˆ
â”‚       â”œâ”€â”€ signal_generator.py        # èµ„é‡‘ä¿¡å·ç”Ÿæˆ
â”‚       â””â”€â”€ ai_data_formatter.py       # AIæ•°æ®æ ¼å¼åŒ–
â”‚
â”œâ”€â”€ ğŸ“ models/                         # æ–°å¢æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ capital_flow_models.py         # èµ„é‡‘æµæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ margin_trading_models.py       # èèµ„èåˆ¸æ¨¡å‹
â”‚   â””â”€â”€ sentiment_models.py            # æƒ…ç»ªæ•°æ®æ¨¡å‹
â”‚
â””â”€â”€ ğŸ“ config/                         # æ–°å¢é…ç½®æ–‡ä»¶
    â”œâ”€â”€ capital_flow_config.yaml       # èµ„é‡‘é¢é…ç½®
    â””â”€â”€ sentiment_config.yaml          # æƒ…ç»ªåˆ†æé…ç½®
```

## å››ã€æ ¸å¿ƒPythonæ–‡ä»¶è¯¦ç»†è®¾è®¡

### 4.1 èµ„é‡‘æµå‘æ•°æ®è·å–å™¨

```python
# src/capital_flow/data_sources/capital_flow_data.py
"""
èµ„é‡‘æµå‘æ•°æ®è·å–æ ¸å¿ƒæ¨¡å—
æ”¯æŒå®æ—¶ã€æ—¥é¢‘ã€åˆ†é’Ÿçº§èµ„é‡‘æµæ•°æ®
"""

class CapitalFlowDataFetcher:
    """èµ„é‡‘æµå‘æ•°æ®è·å–å™¨"""
    
    def __init__(self, market_type):
        self.market_type = market_type
        self.data_sources = self._initialize_sources()
    
    def get_real_time_capital_flow(self, symbol, date=None):
        """
        è·å–å®æ—¶èµ„é‡‘æµå‘
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param date: æ—¥æœŸï¼ˆé»˜è®¤ä»Šå¤©ï¼‰
        :return: å®æ—¶èµ„é‡‘æµæ•°æ®å­—å…¸
        """
        # å®ç°é€»è¾‘ï¼š
        # 1. è·å–å®æ—¶äº”æ¡£è¡Œæƒ…
        # 2. è®¡ç®—ä¸»åŠ›èµ„é‡‘æµå‘
        # 3. è·å–å¤§å•æ•°æ®
        # 4. è®¡ç®—èµ„é‡‘å‡€æµå…¥
        pass
    
    def get_daily_capital_flow(self, symbol, start_date, end_date):
        """
        è·å–æ—¥é¢‘èµ„é‡‘æµå‘
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param start_date: å¼€å§‹æ—¥æœŸ
        :param end_date: ç»“æŸæ—¥æœŸ
        :return: DataFrame
        """
        # å®ç°é€»è¾‘ï¼š
        # 1. è·å–åŒ—å‘/å—å‘èµ„é‡‘ï¼ˆå¦‚é€‚ç”¨ï¼‰
        # 2. è·å–é¾™è™æ¦œæ•°æ®
        # 3. è·å–ä¸»åŠ›èµ„é‡‘æ—¥é¢‘æ•°æ®
        pass
    
    def get_minute_capital_flow(self, symbol, date):
        """
        è·å–åˆ†é’Ÿçº§èµ„é‡‘æµå‘
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param date: æ—¥æœŸ
        :return: DataFrameï¼ˆåˆ†é’Ÿé¢‘ç‡ï¼‰
        """
        pass
    
    def get_sector_capital_flow(self, sector_code, date=None):
        """
        è·å–æ¿å—èµ„é‡‘æµå‘
        :param sector_code: æ¿å—ä»£ç 
        :param date: æ—¥æœŸ
        :return: æ¿å—èµ„é‡‘æµæ•°æ®
        """
        pass
```

### 4.2 èèµ„èåˆ¸æ•°æ®è·å–å™¨

```python
# src/capital_flow/data_sources/margin_trading_data.py
"""
èèµ„èåˆ¸æ•°æ®è·å–
ä»…é€‚ç”¨äºAè‚¡
"""

class MarginTradingDataFetcher:
    """èèµ„èåˆ¸æ•°æ®è·å–å™¨"""
    
    def get_margin_summary(self, symbol, date=None):
        """
        è·å–èèµ„èåˆ¸æ¦‚è¦
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param date: æ—¥æœŸ
        :return: èèµ„èåˆ¸æ•°æ®å­—å…¸
        """
        # è¿”å›å­—æ®µï¼š
        # - èèµ„ä½™é¢
        # - èèµ„ä¹°å…¥é¢
        # - èåˆ¸ä½™é¢
        # - èåˆ¸å–å‡ºé‡
        # - èèµ„èåˆ¸ä½™é¢å æµé€šå¸‚å€¼æ¯”ä¾‹
        pass
    
    def get_margin_history(self, symbol, start_date, end_date):
        """
        è·å–èèµ„èåˆ¸å†å²æ•°æ®
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param start_date: å¼€å§‹æ—¥æœŸ
        :param end_date: ç»“æŸæ—¥æœŸ
        :return: DataFrame
        """
        pass
    
    def get_margin_ranking(self, date=None, top_n=50):
        """
        è·å–èèµ„èåˆ¸æ’å
        :param date: æ—¥æœŸ
        :param top_n: å‰Nå
        :return: DataFrame
        """
        pass
```

### 4.3 èµ„é‡‘æµå‘åˆ†æå™¨

```python
# src/capital_flow/analysis/capital_flow_analyzer.py
"""
èµ„é‡‘æµå‘åˆ†ææ ¸å¿ƒå¼•æ“
"""

class CapitalFlowAnalyzer:
    """èµ„é‡‘æµå‘åˆ†æå™¨"""
    
    def analyze_flow_pattern(self, flow_data):
        """
        åˆ†æèµ„é‡‘æµæ¨¡å¼
        :param flow_data: èµ„é‡‘æµæ•°æ®
        :return: åˆ†æç»“æœå­—å…¸
        """
        # åˆ†æç»´åº¦ï¼š
        # 1. èµ„é‡‘æµå…¥æµå‡ºè¶‹åŠ¿
        # 2. ä¸»åŠ›èµ„é‡‘è¡Œä¸ºè¯†åˆ«
        # 3. æ•£æˆ·èµ„é‡‘è¡Œä¸ºè¯†åˆ«
        # 4. èµ„é‡‘æµä¸ä»·æ ¼å…³ç³»
        pass
    
    def calculate_flow_indicators(self, flow_data):
        """
        è®¡ç®—èµ„é‡‘æµæŠ€æœ¯æŒ‡æ ‡
        :param flow_data: èµ„é‡‘æµæ•°æ®
        :return: æŒ‡æ ‡å­—å…¸
        """
        # è®¡ç®—æŒ‡æ ‡ï¼š
        # - èµ„é‡‘å‡€æµå…¥ç‡
        # - ä¸»åŠ›èµ„é‡‘å æ¯”
        # - èµ„é‡‘æµå…¥å¼ºåº¦
        # - èµ„é‡‘æµä¹–ç¦»ç‡
        # - èµ„é‡‘æµåŠ¨é‡
        pass
    
    def detect_flow_anomalies(self, flow_data):
        """
        æ£€æµ‹èµ„é‡‘æµå¼‚å¸¸
        :param flow_data: èµ„é‡‘æµæ•°æ®
        :return: å¼‚å¸¸æ£€æµ‹ç»“æœ
        """
        # æ£€æµ‹ç±»å‹ï¼š
        # 1. èµ„é‡‘å¤§å¹…æµå…¥æµå‡º
        # 2. ä¸»åŠ›èµ„é‡‘å¼‚åŠ¨
        # 3. èµ„é‡‘æµä¸ä»·æ ¼èƒŒç¦»
        pass
```

### 4.4 èµ„é‡‘æƒ…ç»ªè®¡ç®—å™¨

```python
# src/capital_flow/analysis/sentiment_calculator.py
"""
èµ„é‡‘æƒ…ç»ªé‡åŒ–è®¡ç®—
"""

class CapitalSentimentCalculator:
    """èµ„é‡‘æƒ…ç»ªè®¡ç®—å™¨"""
    
    def calculate_market_sentiment(self, date=None):
        """
        è®¡ç®—å¸‚åœºæ•´ä½“èµ„é‡‘æƒ…ç»ª
        :param date: æ—¥æœŸ
        :return: æƒ…ç»ªæŒ‡æ•°ï¼ˆ0-100ï¼‰
        """
        # è®¡ç®—ç»´åº¦ï¼š
        # 1. åŒ—å‘èµ„é‡‘æƒ…ç»ª
        # 2. ä¸»åŠ›èµ„é‡‘æƒ…ç»ª
        # 3. æ•£æˆ·èµ„é‡‘æƒ…ç»ª
        # 4. æ¿å—è½®åŠ¨æƒ…ç»ª
        pass
    
    def calculate_stock_sentiment(self, symbol, date=None):
        """
        è®¡ç®—ä¸ªè‚¡èµ„é‡‘æƒ…ç»ª
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param date: æ—¥æœŸ
        :return: ä¸ªè‚¡æƒ…ç»ªæŒ‡æ•°
        """
        # è®¡ç®—ç»´åº¦ï¼š
        # 1. ä¸»åŠ›èµ„é‡‘æ€åº¦
        # 2. æ•£æˆ·èµ„é‡‘æ€åº¦
        # 3. æœºæ„èµ„é‡‘æ€åº¦
        # 4. èµ„é‡‘é›†ä¸­åº¦
        pass
    
    def analyze_sentiment_trend(self, symbol, period=20):
        """
        åˆ†æèµ„é‡‘æƒ…ç»ªè¶‹åŠ¿
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param period: åˆ†æå‘¨æœŸ
        :return: è¶‹åŠ¿åˆ†æç»“æœ
        """
        pass
```

### 4.5 èµ„é‡‘æµå‘å›¾è¡¨ç”Ÿæˆå™¨

```python
# src/capital_flow/visualization/flow_charts.py
"""
èµ„é‡‘æµå‘å¯è§†åŒ–å›¾è¡¨
"""

class CapitalFlowChartGenerator:
    """èµ„é‡‘æµå‘å›¾è¡¨ç”Ÿæˆå™¨"""
    
    def create_flow_comparison_chart(self, symbol, date_range):
        """
        åˆ›å»ºèµ„é‡‘æµå‘å¯¹æ¯”å›¾
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param date_range: æ—¥æœŸèŒƒå›´
        :return: å›¾è¡¨å¯¹è±¡
        """
        # å›¾è¡¨å†…å®¹ï¼š
        # 1. ä»·æ ¼èµ°åŠ¿ä¸èµ„é‡‘æµå…¥å åŠ å›¾
        # 2. ä¸»åŠ›vsæ•£æˆ·èµ„é‡‘æµå‘å¯¹æ¯”
        # 3. åŒ—å‘/å—å‘èµ„é‡‘å†å²èµ°åŠ¿
        pass
    
    def create_sentiment_radar_chart(self, sentiment_data):
        """
        åˆ›å»ºèµ„é‡‘æƒ…ç»ªé›·è¾¾å›¾
        :param sentiment_data: æƒ…ç»ªæ•°æ®
        :return: é›·è¾¾å›¾å¯¹è±¡
        """
        # é›·è¾¾å›¾ç»´åº¦ï¼š
        # - ä¸»åŠ›èµ„é‡‘æƒ…ç»ª
        # - æ•£æˆ·èµ„é‡‘æƒ…ç»ª
        # - æœºæ„èµ„é‡‘æƒ…ç»ª
        # - èµ„é‡‘é›†ä¸­åº¦
        # - èµ„é‡‘ç¨³å®šæ€§
        pass
    
    def create_flow_heatmap(self, flow_matrix, date_range):
        """
        åˆ›å»ºèµ„é‡‘æµçƒ­åŠ›å›¾
        :param flow_matrix: èµ„é‡‘æµçŸ©é˜µ
        :param date_range: æ—¥æœŸèŒƒå›´
        :return: çƒ­åŠ›å›¾å¯¹è±¡
        """
        # æ˜¾ç¤ºï¼š
        # 1. æ—¶é—´-èµ„é‡‘æµå¼ºåº¦çƒ­åŠ›å›¾
        # 2. æ¿å—èµ„é‡‘è½®åŠ¨çƒ­åŠ›å›¾
        pass
    
    def create_sankey_diagram(self, flow_data):
        """
        åˆ›å»ºèµ„é‡‘æµå‘æ¡‘åŸºå›¾
        :param flow_data: èµ„é‡‘æµå‘æ•°æ®
        :return: æ¡‘åŸºå›¾å¯¹è±¡
        """
        # æ˜¾ç¤ºèµ„é‡‘åœ¨ä¸åŒä¸»ä½“é—´çš„æµåŠ¨
        # å¦‚ï¼šåŒ—å‘èµ„é‡‘ â†’ æœºæ„ â†’ æ•£æˆ·
        pass
```

### 4.6 æŠ¥å‘Šé›†æˆæ¨¡å—

```python
# src/capital_flow/integration/report_section.py
"""
èµ„é‡‘é¢åˆ†ææŠ¥å‘Šç« èŠ‚ç”Ÿæˆ
"""

class CapitalFlowReportSection:
    """èµ„é‡‘é¢æŠ¥å‘Šç« èŠ‚ç”Ÿæˆå™¨"""
    
    def generate_section(self, symbol, market_type, analysis_data):
        """
        ç”Ÿæˆèµ„é‡‘é¢åˆ†æç« èŠ‚
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param market_type: å¸‚åœºç±»å‹
        :param analysis_data: åˆ†ææ•°æ®
        :return: æŠ¥å‘Šç« èŠ‚å†…å®¹ï¼ˆHTML/PDFæ ¼å¼ï¼‰
        """
        # ç« èŠ‚ç»“æ„ï¼š
        # 1. èµ„é‡‘æµå‘æ¦‚è§ˆ
        # 2. ä¸»åŠ›èµ„é‡‘åˆ†æ
        # 3. èµ„é‡‘æƒ…ç»ªåˆ†æ
        # 4. èèµ„èåˆ¸åˆ†æï¼ˆAè‚¡ï¼‰
        # 5. èµ„é‡‘é¢æŠ€æœ¯æŒ‡æ ‡
        # 6. èµ„é‡‘ä¿¡å·ä¸å»ºè®®
        pass
    
    def generate_summary_table(self, capital_data):
        """
        ç”Ÿæˆèµ„é‡‘é¢æ‘˜è¦è¡¨æ ¼
        :param capital_data: èµ„é‡‘é¢æ•°æ®
        :return: è¡¨æ ¼HTML
        """
        # è¡¨æ ¼å†…å®¹ï¼š
        # | æŒ‡æ ‡ | æ•°å€¼ | çŠ¶æ€ | è¯´æ˜ |
        # |------|------|------|------|
        # | ä¸»åŠ›èµ„é‡‘å‡€æµå…¥ | 1.2äº¿ | å¼ºåŠ¿æµå…¥ | è¿ç»­3æ—¥æµå…¥ |
        # | åŒ—å‘èµ„é‡‘æŒä»“ | 5.6% | å¢æŒ | è¾ƒä¸Šæœˆ+0.5% |
        # | èèµ„ä½™é¢ | 8.9äº¿ | é«˜ä½ | å æµé€šå¸‚å€¼4.2% |
        pass
    
    def generate_signals(self, analysis_data):
        """
        ç”Ÿæˆèµ„é‡‘é¢ä¿¡å·
        :param analysis_data: åˆ†ææ•°æ®
        :return: ä¿¡å·åˆ—è¡¨
        """
        # ä¿¡å·ç±»å‹ï¼š
        # 1. ä¸»åŠ›èµ„é‡‘å¤§å¹…æµå…¥
        # 2. åŒ—å‘èµ„é‡‘è¿ç»­å¢æŒ
        # 3. èèµ„ä½™é¢åˆ›æ–°é«˜
        # 4. èµ„é‡‘æƒ…ç»ªæåº¦ä¹è§‚/æ‚²è§‚
        pass
```

## äº”ã€é…ç½®æ–‡ä»¶å’Œæ•°æ®ç»“æ„

### 5.1 èµ„é‡‘é¢é…ç½®æ–‡ä»¶

```yaml
# config/capital_flow_config.yaml
capital_flow:
  # æ•°æ®æºé…ç½®
  data_sources:
    real_time_source: "akshare"  # å®æ—¶æ•°æ®æº
    historical_source: "tushare"  # å†å²æ•°æ®æº
    backup_source: "yfinance"
  
  # èµ„é‡‘æµå‘åˆ†æé…ç½®
  analysis:
    main_force_threshold: 500000  # ä¸»åŠ›èµ„é‡‘é—¨æ§›ï¼ˆå…ƒï¼‰
    flow_periods: [1, 5, 20, 60]  # åˆ†æå‘¨æœŸï¼ˆæ—¥ï¼‰
    anomaly_detection:
      enabled: true
      threshold_std: 2.5  # å¼‚å¸¸æ£€æµ‹æ ‡å‡†å·®é˜ˆå€¼
    
    # èµ„é‡‘æƒ…ç»ªé…ç½®
    sentiment:
      calculation_method: "composite"  # åˆæˆæ–¹æ³•
      weights:
        main_force: 0.4
        retail: 0.3
        institution: 0.3
      thresholds:
        extreme_bullish: 80
        bullish: 60
        neutral: 40
        bearish: 20
        extreme_bearish: 0
  
  # èèµ„èåˆ¸é…ç½®ï¼ˆAè‚¡ä¸“ç”¨ï¼‰
  margin_trading:
    enabled: true
    warning_thresholds:
      margin_balance_ratio: 0.05  # èèµ„ä½™é¢å æµé€šå¸‚å€¼æ¯”ä¾‹è­¦å‘Šçº¿
      short_selling_ratio: 0.03  # èåˆ¸æ¯”ä¾‹è­¦å‘Šçº¿
  
  # å¯è§†åŒ–é…ç½®
  visualization:
    chart_colors:
      inflow: "#27AE60"  # èµ„é‡‘æµå…¥é¢œè‰²
      outflow: "#E74C3C"  # èµ„é‡‘æµå‡ºé¢œè‰²
      main_force: "#3498DB"  # ä¸»åŠ›èµ„é‡‘é¢œè‰²
      retail: "#F39C12"  # æ•£æˆ·èµ„é‡‘é¢œè‰²
    
    chart_sizes:
      flow_comparison: [12, 8]
      sentiment_radar: [10, 10]
      heatmap: [14, 10]
  
  # æŠ¥å‘Šé›†æˆé…ç½®
  report:
    section_order: 3  # åœ¨æŠ¥å‘Šä¸­ç¬¬3ç« èŠ‚
    include_charts: 3  # åŒ…å«å›¾è¡¨æ•°é‡
    signal_generation: true
```

### 5.2 èµ„é‡‘é¢æ•°æ®æ¨¡å‹

```python
# src/models/capital_flow_models.py
"""
èµ„é‡‘é¢æ•°æ®æ¨¡å‹å®šä¹‰
"""

from dataclasses import dataclass
from datetime import datetime
from typing import List, Dict, Optional
import pandas as pd

@dataclass
class CapitalFlowData:
    """èµ„é‡‘æµå‘æ•°æ®æ¨¡å‹"""
    symbol: str
    date: datetime
    # èµ„é‡‘æµå…¥æµå‡º
    inflow_total: float  # æ€»æµå…¥
    outflow_total: float  # æ€»æµå‡º
    net_inflow: float  # å‡€æµå…¥
    
    # åˆ†ç±»å‹èµ„é‡‘æµ
    main_force_inflow: float  # ä¸»åŠ›èµ„é‡‘æµå…¥
    main_force_outflow: float  # ä¸»åŠ›èµ„é‡‘æµå‡º
    retail_inflow: float  # æ•£æˆ·èµ„é‡‘æµå…¥
    retail_outflow: float  # æ•£æˆ·èµ„é‡‘æµå‡º
    
    # åŒ—å‘/å—å‘èµ„é‡‘
    northbound_flow: Optional[float] = None  # åŒ—å‘èµ„é‡‘
    southbound_flow: Optional[float] = None  # å—å‘èµ„é‡‘
    
    # æˆäº¤æ˜ç»†
    large_order_volume: float  # å¤§å•æˆäº¤é‡
    medium_order_volume: float  # ä¸­å•æˆäº¤é‡
    small_order_volume: float  # å°å•æˆäº¤é‡

@dataclass
class MarginTradingData:
    """èèµ„èåˆ¸æ•°æ®æ¨¡å‹"""
    symbol: str
    date: datetime
    # èèµ„æ•°æ®
    margin_balance: float  # èèµ„ä½™é¢
    margin_buy_amount: float  # èèµ„ä¹°å…¥é¢
    margin_repay_amount: float  # èèµ„å¿è¿˜é¢
    
    # èåˆ¸æ•°æ®
    short_balance: float  # èåˆ¸ä½™é¢
    short_sell_amount: float  # èåˆ¸å–å‡ºé‡
    short_cover_amount: float  # èåˆ¸å¿è¿˜é‡
    
    # æ¯”ä¾‹æŒ‡æ ‡
    margin_ratio: float  # èèµ„ä½™é¢å æµé€šå¸‚å€¼æ¯”ä¾‹
    short_ratio: float  # èåˆ¸ä½™é¢å æµé€šå¸‚å€¼æ¯”ä¾‹

@dataclass
class CapitalSentiment:
    """èµ„é‡‘æƒ…ç»ªæ•°æ®æ¨¡å‹"""
    symbol: str
    date: datetime
    # æƒ…ç»ªæŒ‡æ•°ï¼ˆ0-100ï¼‰
    overall_sentiment: float  # æ€»ä½“æƒ…ç»ª
    main_force_sentiment: float  # ä¸»åŠ›æƒ…ç»ª
    retail_sentiment: float  # æ•£æˆ·æƒ…ç»ª
    institution_sentiment: float  # æœºæ„æƒ…ç»ª
    
    # æƒ…ç»ªè¶‹åŠ¿
    sentiment_trend: str  # ä¸Šå‡/ä¸‹é™/å¹³ç¨³
    trend_strength: float  # è¶‹åŠ¿å¼ºåº¦
    
    # æƒ…ç»ªçŠ¶æ€
    sentiment_state: str  # æåº¦ä¹è§‚/ä¹è§‚/ä¸­æ€§/æ‚²è§‚/æåº¦æ‚²è§‚
    confidence_level: float  # ç½®ä¿¡åº¦

@dataclass
class CapitalFlowSignal:
    """èµ„é‡‘é¢ä¿¡å·æ¨¡å‹"""
    symbol: str
    signal_type: str  # ä¿¡å·ç±»å‹
    signal_strength: float  # ä¿¡å·å¼ºåº¦ï¼ˆ0-100ï¼‰
    trigger_date: datetime
    description: str
    confidence: float  # ç½®ä¿¡åº¦
    related_indicators: List[str]  # ç›¸å…³æŒ‡æ ‡
    recommendation: Optional[str] = None  # æ“ä½œå»ºè®®
```

## å…­ã€APIæ¥å£è®¾è®¡

### 6.1 èµ„é‡‘é¢æ•°æ®API

```python
# src/api/capital_flow_api.py
"""
èµ„é‡‘é¢æ•°æ®APIæ¥å£
"""

class CapitalFlowAPI:
    """èµ„é‡‘é¢æ•°æ®API"""
    
    @staticmethod
    def get_capital_summary(symbol: str, date: str = None) -> Dict:
        """
        è·å–èµ„é‡‘é¢æ¦‚è¦
        """
        pass
    
    @staticmethod
    def get_flow_history(symbol: str, start_date: str, end_date: str) -> pd.DataFrame:
        """
        è·å–å†å²èµ„é‡‘æµå‘
        """
        pass
    
    @staticmethod
    def get_realtime_flow(symbol: str) -> Dict:
        """
        è·å–å®æ—¶èµ„é‡‘æµå‘
        """
        pass
    
    @staticmethod
    def get_sentiment_analysis(symbol: str) -> Dict:
        """
        è·å–èµ„é‡‘æƒ…ç»ªåˆ†æ
        """
        pass
    
    @staticmethod
    def get_margin_data(symbol: str) -> Dict:
        """
        è·å–èèµ„èåˆ¸æ•°æ®ï¼ˆAè‚¡ï¼‰
        """
        pass
    
    @staticmethod
    def generate_capital_report(symbol: str, report_type: str = "full") -> Dict:
        """
        ç”Ÿæˆèµ„é‡‘é¢åˆ†ææŠ¥å‘Š
        :param symbol: è‚¡ç¥¨ä»£ç 
        :param report_type: æŠ¥å‘Šç±»å‹ï¼ˆsummary/full/detailedï¼‰
        """
        pass
```

## ä¸ƒã€é›†æˆåˆ°ä¸»ç³»ç»Ÿçš„ä¿®æ”¹ç‚¹

### 7.1 ä¿®æ”¹ä¸»æ•°æ®è·å–å™¨

```python
# ä¿®æ”¹ src/data/data_acquirer.py
class EnhancedDataAcquirer(DataAcquirer):
    """å¢å¼ºç‰ˆæ•°æ®è·å–å™¨ï¼ˆé›†æˆèµ„é‡‘é¢æ•°æ®ï¼‰"""
    
    def get_all_data(self, symbol, **kwargs):
        """è·å–å…¨éƒ¨æ•°æ®ï¼ˆåŒ…æ‹¬èµ„é‡‘é¢ï¼‰"""
        # åŸæœ‰æŠ€æœ¯é¢æ•°æ®
        technical_data = super().get_all_data(symbol, **kwargs)
        
        # æ–°å¢èµ„é‡‘é¢æ•°æ®
        capital_data = self._get_capital_flow_data(symbol)
        margin_data = self._get_margin_data(symbol) if self.is_a_share else None
        sentiment_data = self._get_sentiment_data(symbol)
        
        return {
            'technical': technical_data,
            'capital_flow': capital_data,
            'margin_trading': margin_data,
            'sentiment': sentiment_data
        }
```

### 7.2 ä¿®æ”¹æŠ¥å‘Šç”Ÿæˆå™¨

```python
# ä¿®æ”¹ src/report/pdf_generator.py
class EnhancedPDFGenerator(PDFGenerator):
    """å¢å¼ºç‰ˆPDFç”Ÿæˆå™¨ï¼ˆåŒ…å«èµ„é‡‘é¢ç« èŠ‚ï¼‰"""
    
    def _add_capital_flow_section(self, story, analysis_data):
        """æ·»åŠ èµ„é‡‘é¢åˆ†æç« èŠ‚"""
        # è·å–èµ„é‡‘é¢åˆ†æå™¨
        capital_analyzer = CapitalFlowAnalyzer()
        
        # ç”Ÿæˆèµ„é‡‘é¢åˆ†æ
        capital_analysis = capital_analyzer.analyze(analysis_data['capital_flow'])
        
        # ç”Ÿæˆç« èŠ‚å†…å®¹
        section_generator = CapitalFlowReportSection()
        section_content = section_generator.generate_section(
            symbol=analysis_data['symbol'],
            market_type=analysis_data['market'],
            analysis_data=capital_analysis
        )
        
        # æ·»åŠ åˆ°æŠ¥å‘Š
        story.append(Paragraph("ç¬¬å››ç« ï¼šèµ„é‡‘é¢åˆ†æ", self.section_style))
        story.append(section_content)
        
        # æ·»åŠ èµ„é‡‘é¢å›¾è¡¨
        chart_generator = CapitalFlowChartGenerator()
        charts = chart_generator.generate_charts(capital_analysis)
        
        for chart in charts:
            story.append(Image(chart, width=6*inch, height=4*inch))
            story.append(Spacer(1, 10))
```

### 7.3 ä¿®æ”¹AIæ•°æ®æ ¼å¼åŒ–å™¨

```python
# ä¿®æ”¹ src/report/json_generator.py
class EnhancedJSONGenerator(JSONGenerator):
    """å¢å¼ºç‰ˆJSONç”Ÿæˆå™¨ï¼ˆåŒ…å«èµ„é‡‘é¢æ•°æ®ï¼‰"""
    
    def generate_ai_data(self, analysis_data):
        """ç”ŸæˆAIåˆ†ææ•°æ®ï¼ˆåŒ…å«èµ„é‡‘é¢ï¼‰"""
        base_data = super().generate_ai_data(analysis_data)
        
        # æ·»åŠ èµ„é‡‘é¢æ•°æ®
        capital_data = {
            'capital_flow': {
                'net_inflow': analysis_data['capital_flow']['net_inflow'],
                'main_force_ratio': analysis_data['capital_flow']['main_force_ratio'],
                'flow_trend': analysis_data['capital_flow']['trend'],
                'anomalies': analysis_data['capital_flow']['anomalies']
            },
            'sentiment': {
                'overall_score': analysis_data['sentiment']['overall'],
                'main_force_sentiment': analysis_data['sentiment']['main_force'],
                'sentiment_state': analysis_data['sentiment']['state']
            },
            'signals': analysis_data.get('capital_signals', [])
        }
        
        if analysis_data.get('margin_trading'):
            capital_data['margin_trading'] = {
                'margin_balance': analysis_data['margin_trading']['balance'],
                'margin_ratio': analysis_data['margin_trading']['ratio'],
                'trend': analysis_data['margin_trading']['trend']
            }
        
        base_data['capital_analysis'] = capital_data
        return base_data
```

## å…«ã€èµ„é‡‘é¢åˆ†ææŒ‡æ ‡å…¬å¼

### 8.1 èµ„é‡‘æµæŒ‡æ ‡å…¬å¼

```python
# src/capital_flow/indicators/flow_indicators.py
"""
èµ„é‡‘æµæŒ‡æ ‡è®¡ç®—å…¬å¼
"""

def calculate_net_inflow_ratio(total_inflow, total_outflow):
    """è®¡ç®—èµ„é‡‘å‡€æµå…¥ç‡"""
    if total_inflow + total_outflow == 0:
        return 0
    return (total_inflow - total_outflow) / (total_inflow + total_outflow) * 100

def calculate_main_force_ratio(main_force_inflow, total_inflow):
    """è®¡ç®—ä¸»åŠ›èµ„é‡‘å æ¯”"""
    if total_inflow == 0:
        return 0
    return main_force_inflow / total_inflow * 100

def calculate_flow_momentum(flow_series, period=5):
    """è®¡ç®—èµ„é‡‘æµåŠ¨é‡"""
    # ä½¿ç”¨ä»·æ ¼åŠ¨é‡å…¬å¼è®¡ç®—èµ„é‡‘æµåŠ¨é‡
    return flow_series.pct_change(period) * 100

def calculate_flow_divergence(price_series, flow_series, window=20):
    """è®¡ç®—èµ„é‡‘æµä¸ä»·æ ¼èƒŒç¦»åº¦"""
    price_return = price_series.pct_change(window)
    flow_return = flow_series.pct_change(window)
    return price_return - flow_return

def calculate_concentration_index(large_order_vol, total_vol):
    """è®¡ç®—èµ„é‡‘é›†ä¸­åº¦"""
    if total_vol == 0:
        return 0
    return large_order_vol / total_vol * 100
```

### 8.2 èµ„é‡‘æƒ…ç»ªæŒ‡æ ‡å…¬å¼

```python
# src/capital_flow/indicators/sentiment_indicators.py
"""
èµ„é‡‘æƒ…ç»ªæŒ‡æ ‡è®¡ç®—å…¬å¼
"""

def calculate_composite_sentiment(indicators, weights):
    """è®¡ç®—ç»¼åˆèµ„é‡‘æƒ…ç»ªæŒ‡æ•°"""
    weighted_sum = sum(indicator * weight for indicator, weight in zip(indicators, weights))
    return min(max(weighted_sum, 0), 100)  # é™åˆ¶åœ¨0-100èŒƒå›´

def calculate_sentiment_trend(sentiment_series, period=5):
    """è®¡ç®—æƒ…ç»ªè¶‹åŠ¿"""
    if len(sentiment_series) < period:
        return "insufficient_data"
    
    recent = sentiment_series[-period:].mean()
    previous = sentiment_series[-(period*2):-period].mean()
    
    if recent > previous * 1.1:
        return "strong_up"
    elif recent > previous * 1.02:
        return "up"
    elif recent < previous * 0.9:
        return "strong_down"
    elif recent < previous * 0.98:
        return "down"
    else:
        return "stable"

def calculate_volatility_adjusted_sentiment(sentiment_score, volatility):
    """è®¡ç®—æ³¢åŠ¨ç‡è°ƒæ•´åçš„æƒ…ç»ªå¾—åˆ†"""
    # é«˜æ³¢åŠ¨ç‡æ—¶é™ä½æƒ…ç»ªå¾—åˆ†ç½®ä¿¡åº¦
    adjustment = 1 / (1 + volatility)
    return sentiment_score * adjustment
```

## ä¹ã€å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€æ•°æ®è·å–ï¼ˆ2-3å¤©ï¼‰
1. å®ç°èµ„é‡‘æµå‘æ•°æ®è·å–æ¨¡å—
2. å®ç°èèµ„èåˆ¸æ•°æ®è·å–ï¼ˆAè‚¡ï¼‰
3. åˆ›å»ºæ•°æ®æ¨¡å‹å’Œé…ç½®æ–‡ä»¶

### Phase 2: åˆ†æå¼•æ“å¼€å‘ï¼ˆ3-4å¤©ï¼‰
1. å®ç°èµ„é‡‘æµå‘åˆ†æå™¨
2. å®ç°èµ„é‡‘æƒ…ç»ªè®¡ç®—å™¨
3. å®ç°ä¸»åŠ›èµ„é‡‘è¯†åˆ«ç®—æ³•

### Phase 3: å¯è§†åŒ–å¼€å‘ï¼ˆ2-3å¤©ï¼‰
1. å®ç°èµ„é‡‘æµå‘å›¾è¡¨
2. å®ç°æƒ…ç»ªä»ªè¡¨æ¿
3. å®ç°çƒ­åŠ›å›¾å’Œæ¡‘åŸºå›¾

### Phase 4: æŠ¥å‘Šé›†æˆï¼ˆ2å¤©ï¼‰
1. é›†æˆåˆ°ä¸»æŠ¥å‘Šç”Ÿæˆå™¨
2. åˆ›å»ºèµ„é‡‘é¢æŠ¥å‘Šç« èŠ‚
3. ç”Ÿæˆèµ„é‡‘é¢ä¿¡å·

### Phase 5: æµ‹è¯•ä¼˜åŒ–ï¼ˆ2å¤©ï¼‰
1. æ•°æ®å‡†ç¡®æ€§æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## åã€æ³¨æ„äº‹é¡¹

1. **æ•°æ®å»¶è¿Ÿå¤„ç†**ï¼šèµ„é‡‘é¢æ•°æ®é€šå¸¸æœ‰15åˆ†é’Ÿåˆ°T+1çš„å»¶è¿Ÿï¼Œéœ€è¦åœ¨æŠ¥å‘Šä¸­æ˜ç¡®æ ‡æ³¨
2. **å¸‚åœºå·®å¼‚**ï¼šAè‚¡å’Œæ¸¯è‚¡çš„èµ„é‡‘é¢æŒ‡æ ‡ä¸åŒï¼Œéœ€è¦åˆ†åˆ«å¤„ç†
3. **å®æ—¶æ€§è¦æ±‚**ï¼šç›˜ä¸­èµ„é‡‘æµå‘æ•°æ®éœ€è¦é«˜é¢‘æ›´æ–°
4. **æ•°æ®è´¨é‡**ï¼šèµ„é‡‘é¢æ•°æ®å¯èƒ½å­˜åœ¨å™ªå£°ï¼Œéœ€è¦æ•°æ®æ¸…æ´—å’ŒéªŒè¯
5. **åˆè§„æ€§**ï¼šèµ„é‡‘æµå‘æ•°æ®ä½¿ç”¨éœ€ç¬¦åˆç›¸å…³æ³•è§„

è¿™ä¸ªèµ„é‡‘é¢åˆ†ææ¨¡å—å¯ä»¥æ˜¾è‘—å¢å¼ºæŠ¥å‘Šçš„ä»·å€¼ï¼Œä¸ºæŠ•èµ„è€…æä¾›æ›´å…¨é¢çš„åˆ†æè§†è§’ã€‚